<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2Z DSA Course Roadmap</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --tertiary-color: #16a085;
            --tertiary-hover-color: #1abc9c;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #495057;
            --text-color: #343a40;
            --border-color: #dee2e6;
            --white-color: #ffffff;
            --link-color: var(--secondary-color);
            --success-color: #2ecc71;
            --warning-color: #f1c40f;
            --danger-color: #e74c3c;
            --completed-bg-color: #e8f5e9;
            --completed-text-color: #388e3c;
            --completed-gradient-start: #27ae60;
            --completed-gradient-end: #2ecc71;
        }

        /* General Body Styling */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.5;
            background-color: var(--light-gray);
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
        }

        /* Main Container for the Roadmap */
        .container {
            max-width: 1200px;
            margin: 1rem auto;
            background-color: var(--white-color);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
        }

        /* Heading Styles */
        h1 {
            text-align: center;
            font-size: 2rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--medium-gray);
            padding-bottom: 0.6rem;
            margin-bottom: 1rem;
        }

        /* Collapsible Section Styles */
        .collapsible,
        .sub-collapsible {
            color: #fff;
            cursor: pointer;
            padding: 0.75rem 1rem;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            margin-top: 0.75rem;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-image 0.3s ease;
        }

        .collapsible {
            background-image: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            font-size: 1.5rem;
        }

        .sub-collapsible {
            background-image: linear-gradient(45deg, var(--tertiary-color), var(--tertiary-hover-color));
            font-size: 1.2rem;
        }

        .collapsible:hover,
        .collapsible.active {
            background-image: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        }

        .sub-collapsible:hover,
        .sub-collapsible.active {
            background-image: linear-gradient(45deg, var(--tertiary-hover-color), var(--tertiary-color));
        }

        .collapsible.completed,
        .sub-collapsible.completed {
            background-image: linear-gradient(45deg, var(--completed-gradient-start), var(--completed-gradient-end));
        }

        .collapsible-title {
            flex-grow: 1;
        }

        .progress-counter {
            font-size: 0.7em;
            font-weight: 500;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.2rem 0.6rem;
            border-radius: 1rem;
            margin-left: 1rem;
            white-space: nowrap;
        }

        .collapsible::after,
        .sub-collapsible::after {
            content: '+';
            font-size: 1.5em;
            font-weight: bold;
            transition: transform 0.3s ease;
            margin-left: 1rem;
        }

        .collapsible.active::after,
        .sub-collapsible.active::after {
            transform: rotate(45deg);
        }

        .content,
        .sub-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
            background-color: transparent;
        }

        .content {
            border-radius: 0 0 8px 8px;
            border-top: none;
            padding: 0 0.5rem;
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.75rem 0;
            border: 1px solid var(--border-color);
            table-layout: fixed;
        }

        th,
        td {
            border: 1px solid var(--border-color);
            padding: 0.5rem 0.4rem;
            text-align: center;
            vertical-align: middle;
            word-wrap: break-word;
        }

        .topic-cell {
            text-align: left;
            font-weight: 500;
            width: 40%;
        }

        thead th:not(:first-child),
        tbody td:not(.topic-cell) {
            width: 8.57%;
        }

        .topic-title {
            font-size: 0.95rem;
            padding: 0.5rem;
        }

        thead th {
            background-color: var(--secondary-color);
            color: #fff;
            font-weight: 600;
        }

        /* Difficulty & Completion Styles */
        tr.completed {
            background-color: var(--completed-bg-color) !important;
            color: var(--completed-text-color);
        }

        tr.completed a {
            color: var(--completed-text-color);
            font-weight: 500;
        }

        .difficulty-easy td:first-child {
            box-shadow: inset 4px 0 0 0 var(--success-color);
        }

        .difficulty-medium td:first-child {
            box-shadow: inset 4px 0 0 0 var(--warning-color);
        }

        .difficulty-hard td:first-child {
            box-shadow: inset 4px 0 0 0 var(--danger-color);
        }

        /* Link & SVG Styling */
        .link-cell {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .link-cell:hover {
            background-color: var(--medium-gray);
        }

        .link-cell a {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: -0.5rem -0.4rem;
            padding: 0.5rem 0.4rem;
            color: var(--link-color);
            text-decoration: none;
            height: 100%;
        }

        .link-cell svg {
            width: 22px;
            height: 22px;
            fill: currentColor;
        }

        /* 'Not Applicable' Cell Styling */
        .na-cell {
            color: #bdc3c7;
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Custom Checkbox */
        .status-cell {
            cursor: pointer;
        }

        .status-checkbox {
            pointer-events: none;
            width: 1.2rem;
            height: 1.2rem;
        }
    </style>
</head>

<body>
    <div id="roadmap-container" class="container">
        <h1>Loading Roadmap...</h1>
    </div>
    <script>
        const STORAGE_KEY = 'dsaRoadmapProgress';

        // SVG logos for platforms, standardized to 24x24px
        const platformLogos = {
            'Post': `<img src="./assets/logo/post.svg" alt="BLOG">`,
            'YT': `<img src="./assets/logo/yt.svg" alt="YT">`,
            'TUF': `<img src="./assets/logo/tuf.svg" alt="TUF">`,
            'GFG': `<img src="./assets/logo/gfg.svg" alt="GFG">`,
            'CN': `<img src="./assets/logo/cn.svg" alt="CN">`,
            'LC': `<img src="./assets/logo/lc.svg" alt="LC">`
        };

        document.addEventListener('DOMContentLoaded', () => {
            fetch('a2z.json').then(response => {
                if (!response.ok) throw new Error('Network response was not ok. Make sure a2z.json is in the same folder.');
                return response.json();
            }).then(roadmapData => {
                const progress = loadCompletionState();
                generateRoadmap(roadmapData, progress);
                addEventListeners();
            }).catch(handleError);
        });

        function generateRoadmap(data, progress) {
            const container = document.getElementById('roadmap-container');
            let htmlContent = `<h1>A2Z DSA Course Roadmap</h1>`;
            data.forEach(step => {
                let totalStepTopics = 0;
                let completedStepTopics = 0;
                let subStepsHtml = '';
                if (step.sub_steps) {
                    step.sub_steps.forEach(subStep => {
                        const totalSubStepTopics = subStep.topics.length;
                        const completedSubStepTopics = subStep.topics.filter(t => progress[t.id]).length;
                        const isSubStepComplete = totalSubStepTopics > 0 && completedSubStepTopics === totalSubStepTopics;
                        const subStepCompletedClass = isSubStepComplete ? 'completed' : '';
                        totalStepTopics += totalSubStepTopics;
                        completedStepTopics += completedSubStepTopics;

                        subStepsHtml += `
                                <button type="button" class="sub-collapsible ${subStepCompletedClass}" data-step="${step.step_no}" data-substep="${subStep.sub_step_no}">
                                    <span class="collapsible-title">${subStep.sub_step_no}. ${subStep.sub_step_title.replace(/\n/g, ' ')}</span>
                                    <span class="progress-counter">${completedSubStepTopics}/${totalSubStepTopics}</span>
                                </button>
                                <div class="sub-content">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Topic</th>
                                                <th title="Article/Post">Post</th>
                                                <th title="YouTube">YT</th>
                                                <th title="TakeUForward+">TUF</th>
                                                <th title="GeeksForGeeks">GFG</th>
                                                <th title="CodingNinjas">CN</th>
                                                <th title="LeetCode">LC</th>
                                                <th>Done</th>
                                            </tr>
                                        </thead>
                                        <tbody>`;
                        subStep.topics.forEach(topic => {
                            const isCompleted = progress[topic.id] || false;
                            const difficultyClass = getDifficultyClass(topic.difficulty);
                            const completedClass = isCompleted ? 'completed' : '';
                            const checkedAttr = isCompleted ? 'checked' : '';
                            let tooltipText = '';
                            if (topic.ques_topic) {
                                try {
                                    const topics = JSON.parse(topic.ques_topic);
                                    tooltipText = topics.map(t => t.label).join(', ');
                                } catch (e) { /* Gracefully fail */ }
                            }
                            subStepsHtml += `
                                            <tr class="${difficultyClass} ${completedClass}" data-topic-id="${topic.id}">
                                                <td class="topic-cell" title="${tooltipText}">
                                                    <div class="topic-title">${topic.question_title}</div>
                                                </td>
                                                ${createLinkCell(topic.post_link, 'Post')}
                                                ${createLinkCell(topic.yt_link, 'YT')}
                                                ${createLinkCell(topic.plus_link, 'TUF')}
                                                ${createLinkCell(topic.gfg_link, 'GFG')}
                                                ${createLinkCell(topic.cs_link, 'CN')}
                                                ${createLinkCell(topic.lc_link, 'LC')}
                                                <td class="status-cell">
                                                    <input type="checkbox" class="status-checkbox" data-id="${topic.id}" ${checkedAttr}>
                                                </td>
                                            </tr>`;
                        });
                        subStepsHtml += `
                                        </tbody>
                                    </table>
                                </div>`;
                    });
                }
                const isStepComplete = totalStepTopics > 0 && completedStepTopics === totalStepTopics;
                const stepCompletedClass = isStepComplete ? 'completed' : '';
                htmlContent += `
                            <button type="button" class="collapsible ${stepCompletedClass}" data-step="${step.step_no}">
                                <span class="collapsible-title">Step ${step.step_no}: ${step.step_title}</span>
                                <span class="progress-counter">${completedStepTopics}/${totalStepTopics}</span>
                            </button>
                            <div class="content">${subStepsHtml}</div>`;
            });
            container.innerHTML = htmlContent;
        }

        function createLinkCell(url, label) {
            if (url) {
                const logo = platformLogos[label] || label;
                return `
                                <td class="link-cell">
                                    <a href="${url}" target="_blank" rel="noopener noreferrer" title="${label}">${logo}</a>
                                </td>`;
            } else {
                return `<td class="na-cell">-</td>`;
            }
        }

        function getDifficultyClass(difficulty) {
            const difficultyMap = {
                0: 'difficulty-easy',
                1: 'difficulty-medium',
                2: 'difficulty-hard'
            };
            return difficultyMap[difficulty] || '';
        }

        function loadCompletionState() {
            try {
                const savedProgress = localStorage.getItem(STORAGE_KEY);
                return savedProgress ? JSON.parse(savedProgress) : {};
            } catch (e) {
                console.error("Failed to load progress from localStorage", e);
                return {};
            }
        }

        function saveCompletionState(progress) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
            } catch (e) {
                console.error("Failed to save progress to localStorage", e);
            }
        }

        function updateCounters(element) {
            const progress = loadCompletionState();
            const subStepContent = element.closest('.sub-content');
            if (subStepContent) {
                const subStepButton = subStepContent.previousElementSibling;
                const topicsInSubStep = Array.from(subStepContent.querySelectorAll('.status-checkbox'));
                const totalSubStep = topicsInSubStep.length;
                const completedSubStep = topicsInSubStep.filter(cb => progress[cb.dataset.id]).length;
                subStepButton.querySelector('.progress-counter').textContent = `${completedSubStep}/${totalSubStep}`;
                const isSubStepComplete = totalSubStep > 0 && completedSubStep === totalSubStep;
                subStepButton.classList.toggle('completed', isSubStepComplete);
            }
            const mainContent = element.closest('.content');
            if (mainContent) {
                const mainStepButton = mainContent.previousElementSibling;
                const topicsInStep = Array.from(mainContent.querySelectorAll('.status-checkbox'));
                const totalStep = topicsInStep.length;
                const completedStep = topicsInStep.filter(cb => progress[cb.dataset.id]).length;
                mainStepButton.querySelector('.progress-counter').textContent = `${completedStep}/${totalStep}`;
                const isStepComplete = totalStep > 0 && completedStep === totalStep;
                mainStepButton.classList.toggle('completed', isStepComplete);
            }
        }

        function addEventListeners() {
            const container = document.getElementById('roadmap-container');
            container.addEventListener('click', function (event) {
                const collapsible = event.target.closest('.collapsible, .sub-collapsible');
                const statusCell = event.target.closest('.status-cell');

                if (collapsible) {
                    collapsible.classList.toggle('active');
                    const content = collapsible.nextElementSibling;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        const parentContent = collapsible.closest('.content');
                        if (parentContent && parentContent.style.maxHeight) {
                            parentContent.style.maxHeight = (parseInt(parentContent.style.maxHeight) - content.scrollHeight) + "px";
                        }
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        const parentContent = collapsible.closest('.content');
                        if (parentContent && parentContent.style.maxHeight) {
                            parentContent.style.maxHeight = (parseInt(parentContent.style.maxHeight) + content.scrollHeight) + "px";
                        }
                    }
                }

                if (statusCell) {
                    const checkbox = statusCell.querySelector('.status-checkbox');
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                        const topicId = checkbox.dataset.id;
                        const isChecked = checkbox.checked;
                        const progress = loadCompletionState();
                        progress[topicId] = isChecked;
                        saveCompletionState(progress);
                        const row = checkbox.closest('tr');
                        if (row) {
                            row.classList.toggle('completed', isChecked);
                        }
                        updateCounters(checkbox);
                    }
                }
            });
        }

        function handleError(error) {
            console.error('Error:', error);
            const container = document.getElementById('roadmap-container');
            container.innerHTML = `
                <h1>Error</h1>
                <p>Could not load the roadmap. Please ensure 'a2z.json' is in the same directory and correctly formatted.</p>
                <p><em>${error.message}</em></p>`;
        }
    </script>
</body>

</html>