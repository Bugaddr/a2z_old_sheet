<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2Z DSA Course Roadmap</title>
    <style>
        :root {
            /* Midnight Neon Palette */
            --primary-color: #7289da;
            /* Discord Blue */
            --secondary-color: #4e5d94;
            /* Darker Blue */
            --tertiary-color: #43b581;
            /* Green */
            --tertiary-hover-color: #3aa171;
            /* Darker Green */
            --light-gray: #2c2f33;
            /* Almost Black */
            --medium-gray: #23272a;
            /* Darker Background */
            --dark-gray: #99aab5;
            /* Light Gray Text */
            --text-color: #ffffff;
            --border-color: #40444b;
            --white-color: #36393f;
            /* Container Background */
            --link-color: var(--primary-color);
            --success-color: #43b581;
            /* Bright Green */
            --warning-color: #faa61a;
            /* Bright Yellow */
            --danger-color: #f04747;
            /* Bright Red */
            --completed-bg-color: rgba(67, 181, 129, 0.1);
            --completed-text-color: var(--success-color);
            --completed-gradient-start: #43b581;
            --completed-gradient-end: #57f287;
            --progress-bar-bg: rgba(255, 255, 255, 0.1);
        }

        /* General Body Styling */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: var(--medium-gray);
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
        }

        /* Main Container for the Roadmap */
        .container {
            max-width: 1200px;
            margin: 1rem auto;
            background-color: var(--white-color);
            padding: 1rem 1.5rem;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }

        /* Heading Styles */
        h1 {
            text-align: center;
            font-size: 2.25rem;
            color: var(--primary-color);
            border-bottom: 3px solid var(--border-color);
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
        }

        /* Collapsible Section Styles */
        .collapsible,
        .sub-collapsible {
            color: #fff;
            cursor: pointer;
            padding: 0.85rem 1.25rem;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            margin-top: 0.75rem;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-image 0.4s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        /* Progress Bar Pseudo-element */
        .collapsible::before,
        .sub-collapsible::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--progress-width, 0%);
            background-color: var(--progress-bar-bg);
            transition: width 0.4s ease-out, background-color 0.4s ease;
            z-index: -1;
            border-radius: 10px;
        }

        .collapsible {
            background-image: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            font-size: 1.5rem;
        }

        .sub-collapsible {
            background-image: linear-gradient(45deg, var(--tertiary-color), var(--tertiary-hover-color));
            font-size: 1.2rem;
        }

        .collapsible:hover,
        .collapsible.active {
            background-image: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        }

        .sub-collapsible:hover,
        .sub-collapsible.active {
            background-image: linear-gradient(45deg, var(--tertiary-hover-color), var(--tertiary-color));
        }

        .collapsible.completed,
        .sub-collapsible.completed {
            background-image: linear-gradient(45deg, var(--completed-gradient-start), var(--completed-gradient-end));
        }

        .collapsible.completed::before,
        .sub-collapsible.completed::before {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .collapsible-title {
            flex-grow: 1;
        }

        .progress-counter {
            font-size: 0.7em;
            font-weight: 500;
            background-color: rgba(0, 0, 0, 0.25);
            padding: 0.2rem 0.6rem;
            border-radius: 1rem;
            margin-left: 1rem;
            white-space: nowrap;
        }

        .collapsible::after,
        .sub-collapsible::after {
            content: '+';
            font-size: 1.5em;
            font-weight: bold;
            transition: transform 0.3s ease;
            margin-left: 1rem;
        }

        .collapsible.active::after,
        .sub-collapsible.active::after {
            transform: rotate(45deg);
        }

        .content,
        .sub-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
            background-color: transparent;
        }

        .content {
            border-radius: 0 0 8px 8px;
            border-top: none;
            padding: 0 0.5rem;
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.75rem 0;
            border: 1px solid var(--border-color);
            table-layout: fixed;
            min-width: 700px;
        }

        th,
        td {
            border: 1px solid var(--border-color);
            padding: 0.6rem 0.5rem;
            text-align: center;
            vertical-align: middle;
            word-wrap: break-word;
        }

        .topic-cell {
            text-align: left;
            font-weight: 500;
            width: 40%;
        }

        thead th:not(:first-child),
        tbody td:not(.topic-cell) {
            width: 8.57%;
        }

        .topic-title {
            font-size: 0.95rem;
            padding: 0.5rem;
        }

        thead th {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            font-weight: 600;
        }

        /* Difficulty & Completion Styles */
        tr {
            color: var(--dark-gray);
        }

        tr.completed {
            background-color: var(--completed-bg-color) !important;
            color: var(--completed-text-color) !important;
        }

        tr.completed .topic-title {
            text-decoration: line-through;
            text-decoration-color: var(--completed-text-color);
            text-decoration-thickness: 2px;
        }

        tr.completed a {
            color: var(--completed-text-color) !important;
            font-weight: 500;
        }

        .difficulty-easy td:first-child {
            box-shadow: inset 5px 0 0 0 var(--success-color);
        }

        .difficulty-medium td:first-child {
            box-shadow: inset 5px 0 0 0 var(--warning-color);
        }

        .difficulty-hard td:first-child {
            box-shadow: inset 5px 0 0 0 var(--danger-color);
        }

        /* Link & SVG Styling */
        .link-cell {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .link-cell:hover {
            background-color: var(--light-gray);
        }

        .link-cell a {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: -0.5rem -0.4rem;
            padding: 0.5rem 0.4rem;
            color: var(--link-color);
            text-decoration: none;
            height: 100%;
        }

        .link-cell svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .na-cell {
            color: #bdc3c7;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .status-cell {
            cursor: pointer;
        }

        .status-checkbox {
            pointer-events: none;
            width: 1.3rem;
            height: 1.3rem;
        }
    </style>
</head>

<body>
    <div id="roadmap-container" class="container">
        <h1>Loading Roadmap...</h1>
    </div>
    <script>
        const STORAGE_KEY = 'dsaRoadmapProgress';

        const platformLogos = {
            'Post': `<img src="./assets/logo/post.svg" alt="BLOG">`,
            'YT': `<img src="./assets/logo/yt.svg" alt="YT">`,
            'TUF': `<img src="./assets/logo/tuf.svg" alt="TUF">`,
            'GFG': `<img src="./assets/logo/gfg.svg" alt="GFG">`,
            'CN': `<img src="./assets/logo/cn.svg" alt="CN">`,
            'LC': `<img src="./assets/logo/lc.svg" alt="LC">`
        };

        document.addEventListener('DOMContentLoaded', () => {
            fetch('a2z.json').then(response => {
                if (!response.ok) throw new Error('Network response was not ok. Make sure a2z.json is in the same folder.');
                return response.json();
            }).then(roadmapData => {
                const progress = loadCompletionState();
                generateRoadmap(roadmapData, progress);
                addEventListeners();
            }).catch(handleError);
        });

        function generateRoadmap(data, progress) {
            const container = document.getElementById('roadmap-container');
            let htmlContent = `<h1>A2Z DSA Course Roadmap</h1>`;
            data.forEach(step => {
                let totalStepTopics = 0;
                let completedStepTopics = 0;
                let subStepsHtml = '';
                if (step.sub_steps) {
                    step.sub_steps.forEach(subStep => {
                        const totalSubStepTopics = subStep.topics.length;
                        const completedSubStepTopics = subStep.topics.filter(t => progress[t.id]).length;
                        const isSubStepComplete = totalSubStepTopics > 0 && completedSubStepTopics === totalSubStepTopics;
                        const subStepProgressClass = isSubStepComplete ? 'completed' : '';
                        const subStepPercentage = totalSubStepTopics > 0 ? (completedSubStepTopics / totalSubStepTopics) * 100 : 0;
                        totalStepTopics += totalSubStepTopics;
                        completedStepTopics += completedSubStepTopics;

                        subStepsHtml += `
                                <button type="button" class="sub-collapsible ${subStepProgressClass}" style="--progress-width: ${subStepPercentage}%" data-step="${step.step_no}" data-substep="${subStep.sub_step_no}">
                                    <span class="collapsible-title">${subStep.sub_step_no}. ${subStep.sub_step_title.replace(/\n/g, ' ')}</span>
                                    <span class="progress-counter">${completedSubStepTopics}/${totalSubStepTopics}</span>
                                </button>
                                <div class="sub-content">
                                    <div class="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Topic</th>
                                                    <th title="Article/Post">Post</th>
                                                    <th title="YouTube">YT</th>
                                                    <th title="TakeUForward+">TUF</th>
                                                    <th title="GeeksForGeeks">GFG</th>
                                                    <th title="CodingNinjas">CN</th>
                                                    <th title="LeetCode">LC</th>
                                                    <th>Done</th>
                                                </tr>
                                            </thead>
                                            <tbody>`;
                        subStep.topics.forEach(topic => {
                            const isCompleted = progress[topic.id] || false;
                            const difficultyClass = getDifficultyClass(topic.difficulty);
                            const completedClass = isCompleted ? 'completed' : '';
                            const checkedAttr = isCompleted ? 'checked' : '';
                            subStepsHtml += `
                                                <tr class="${difficultyClass} ${completedClass}" data-topic-id="${topic.id}">
                                                    <td class="topic-cell">
                                                        <div class="topic-title">${topic.question_title}</div>
                                                    </td>
                                                    ${createLinkCell(topic.post_link, 'Post')}
                                                    ${createLinkCell(topic.yt_link, 'YT')}
                                                    ${createLinkCell(topic.plus_link, 'TUF')}
                                                    ${createLinkCell(topic.gfg_link, 'GFG')}
                                                    ${createLinkCell(topic.cs_link, 'CN')}
                                                    ${createLinkCell(topic.lc_link, 'LC')}
                                                    <td class="status-cell">
                                                        <input type="checkbox" class="status-checkbox" data-id="${topic.id}" ${checkedAttr}>
                                                    </td>
                                                </tr>`;
                        });
                        subStepsHtml += `
                                            </tbody>
                                        </table>
                                    </div>
                                </div>`;
                    });
                }
                const isStepComplete = totalStepTopics > 0 && completedStepTopics === totalStepTopics;
                const stepProgressClass = isStepComplete ? 'completed' : '';
                const stepPercentage = totalStepTopics > 0 ? (completedStepTopics / totalStepTopics) * 100 : 0;
                htmlContent += `
                            <button type="button" class="collapsible ${stepProgressClass}" style="--progress-width: ${stepPercentage}%" data-step="${step.step_no}">
                                <span class="collapsible-title">Step ${step.step_no}: ${step.step_title}</span>
                                <span class="progress-counter">${completedStepTopics}/${totalStepTopics}</span>
                            </button>
                            <div class="content">${subStepsHtml}</div>`;
            });
            container.innerHTML = htmlContent;
        }

        function createLinkCell(url, label) {
            if (url) {
                const logo = platformLogos[label] || label;
                return `<td class="link-cell"><a href="${url}" target="_blank" rel="noopener noreferrer" title="${label}">${logo}</a></td>`;
            } else {
                return `<td class="na-cell">-</td>`;
            }
        }

        function getDifficultyClass(difficulty) {
            return ['difficulty-easy', 'difficulty-medium', 'difficulty-hard'][difficulty] || '';
        }

        function loadCompletionState() {
            try {
                const savedProgress = localStorage.getItem(STORAGE_KEY);
                return savedProgress ? JSON.parse(savedProgress) : {};
            } catch (e) {
                console.error("Failed to load progress from localStorage", e);
                return {};
            }
        }

        function saveCompletionState(progress) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
            } catch (e) {
                console.error("Failed to save progress to localStorage", e);
            }
        }

        function updateCounters(element) {
            const progress = loadCompletionState();
            const subStepContent = element.closest('.sub-content');
            if (subStepContent) {
                const subStepButton = subStepContent.previousElementSibling;
                const topicsInSubStep = Array.from(subStepContent.querySelectorAll('.status-checkbox'));
                const totalSubStep = topicsInSubStep.length;
                const completedSubStep = topicsInSubStep.filter(cb => progress[cb.dataset.id]).length;
                subStepButton.querySelector('.progress-counter').textContent = `${completedSubStep}/${totalSubStep}`;

                const subStepPercentage = totalSubStep > 0 ? (completedSubStep / totalSubStep) * 100 : 0;
                subStepButton.style.setProperty('--progress-width', `${subStepPercentage}%`);
                subStepButton.classList.toggle('completed', totalSubStep > 0 && completedSubStep === totalSubStep);
            }
            const mainContent = element.closest('.content');
            if (mainContent) {
                const mainStepButton = mainContent.previousElementSibling;
                const topicsInStep = Array.from(mainContent.querySelectorAll('.status-checkbox'));
                const totalStep = topicsInStep.length;
                const completedStep = topicsInStep.filter(cb => progress[cb.dataset.id]).length;
                mainStepButton.querySelector('.progress-counter').textContent = `${completedStep}/${totalStep}`;

                const stepPercentage = totalStep > 0 ? (completedStep / totalStep) * 100 : 0;
                mainStepButton.style.setProperty('--progress-width', `${stepPercentage}%`);
                mainStepButton.classList.toggle('completed', totalStep > 0 && completedStep === totalStep);
            }
        }

        function addEventListeners() {
            const container = document.getElementById('roadmap-container');
            container.addEventListener('click', function (event) {
                const collapsible = event.target.closest('.collapsible, .sub-collapsible');
                const statusCell = event.target.closest('.status-cell');

                if (collapsible) {
                    collapsible.classList.toggle('active');
                    const content = collapsible.nextElementSibling;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        const parentContent = content.closest('.content');
                        if (parentContent && parentContent.style.maxHeight) {
                            parentContent.style.maxHeight = (parentContent.scrollHeight + content.scrollHeight) + "px";
                        }
                    }
                }

                if (statusCell) {
                    const checkbox = statusCell.querySelector('.status-checkbox');
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                        const topicId = checkbox.dataset.id;
                        const isChecked = checkbox.checked;
                        const progress = loadCompletionState();
                        progress[topicId] = isChecked;
                        saveCompletionState(progress);
                        checkbox.closest('tr').classList.toggle('completed', isChecked);
                        updateCounters(checkbox);
                    }
                }
            });
        }

        function handleError(error) {
            console.error('Error:', error);
            const container = document.getElementById('roadmap-container');
            container.innerHTML = `
                <h1>Error</h1>
                <p>Could not load the roadmap. Please ensure 'a2z.json' is in the same directory and correctly formatted.</p>
                <p><em>${error.message}</em></p>`;
        }
    </script>
</body>

</html>